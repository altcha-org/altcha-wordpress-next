(function(f,l){typeof exports=="object"&&typeof module<"u"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(f=typeof globalThis<"u"?globalThis:f||self,l(f["[name]"]={}))})(this,(function(f){"use strict";/*!
 * Proprietary Component - Minified JavaScript
 * Copyright (c) 2025 BAU Software s.r.o., Czechia. All rights reserved.
 *
 * This file is provided only in minified form and is not source-available.
 * Unauthorized reverse engineering, modification, or distribution is prohibited.
 */const l=Symbol("events_intercepted"),p=Symbol("request_intercepted"),X=x=>{const{debug:D=!1,formsSelector:I="form",filter:A,intercept:h=["fetch","forms","xhr"],invisible:g=!0,onFailure:L,onVerified:O,preventDocumentClicks:F=!0,widget:E}=x,R=globalThis.fetch,C=XMLHttpRequest.prototype.open,q=XMLHttpRequest.prototype.send,U=XMLHttpRequest.prototype.setRequestHeader,S=EventTarget.prototype.addEventListener,V=[window,document,document.body],T=!!window.isSecureContext,v="Secure Context (HTTPS) required! Learn more: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts";let u=[],d=[],w=!1;c("Activating interceptor",h),T||c(new Error(v)),h.length&&B(),h.includes("fetch")&&G(),h.includes("forms")&&N(),h.includes("xhr")&&W();function j(){d.forEach(e=>{delete e.dataset.intercepted,e.removeEventListener("submit",_,{capture:!0}),e.querySelectorAll('[type="submit"]').forEach(t=>{t.removeEventListener("click",P,{capture:!0})})}),globalThis.fetch=R,XMLHttpRequest.prototype.open=C,XMLHttpRequest.prototype.send=q,XMLHttpRequest.prototype.setRequestHeader=U,EventTarget.prototype.addEventListener=S,delete XMLHttpRequest.prototype[p],delete EventTarget.prototype[l],d=[],u=[],c("Interceptor destroyed")}function B(){return l in EventTarget.prototype?!1:(EventTarget.prototype.addEventListener=function(e,t,n){if(!(e==="click"&&V.includes(this)&&t&&(u.push([t,n]),w)))return S.call(this,e,t,n)},EventTarget.prototype[l]=!0,!0)}function G(){return p in globalThis.fetch?!1:(c("Registering fetch hooks"),globalThis.fetch=async(e,t={})=>{const n=t?.method||"GET",o=String(e),r=await k("fetch",n,o,t.headers,t.body);if(r){c("Intercepting fetch",n,o);try{if(!await b(typeof r=="object"?r:void 0))throw new Error("Unable to receive verification payload.")}catch(s){try{L?.(String(s.message||s))}catch{}throw s}}return R(e,t)},Object.assign(globalThis.fetch,{[p]:!0}),!0)}function N(){return d=[...new Set([...d,...document.querySelectorAll(I)])],c("Registering form hooks:",d.length),d.forEach(e=>{e.dataset.intercepted!=="true"&&(e.dataset.intercepted="true",e.addEventListener("submit",_,{capture:!0}),e.querySelectorAll('[type="submit"]').forEach(t=>{const n=t;n.onclick&&n.addEventListener("click",P,{capture:!0})}))}),!0}function W(){return p in XMLHttpRequest.prototype?!1:(c("Registering XMLHttpRequest hooks"),XMLHttpRequest.prototype.open=function(e,t,...n){return this._method=e.toUpperCase(),this._url=t,C.call(this,e,t,...n)},XMLHttpRequest.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers=new Headers),this._headers.append(e,t),U.call(this,e,t)},XMLHttpRequest.prototype.send=function(e){const t=this._method||"GET",n=String(this._url||""),o=r=>{try{L?.(String(r.message||r))}catch{}this.dispatchEvent(new Event(String(r.message||r))),typeof this.onerror=="function"&&this.onerror.call(this,r)};k("xhr",t,n,this._headers,e).then(r=>{r?(c("Intercepting XMLHttpRequest",t,n),b(typeof r=="object"?r:void 0).then(s=>{if(s)q.call(this,e);else throw new Error("Unable to receive verification payload.")}).catch(o)):q.call(this,e)}).catch(o)},XMLHttpRequest.prototype[p]=!0,!0)}function c(...e){(D||e.some(t=>t instanceof Error))&&console[e[0]instanceof Error?"error":"log"]("ALTCHA Interceptor:",...e)}function Y(e,t){try{return e=e instanceof URL?e:new URL(e,location.origin),t=t instanceof URL?t:new URL(t,location.origin),e.origin===t.origin&&e.pathname===t.pathname}catch{}return!1}function _(e){const t=e.target;if(w){e.preventDefault(),e.stopPropagation();return}if(t.dataset.altchaprocessing||t.querySelector("altcha-widget"))return;const n=t.getAttribute("method")?.toUpperCase()||"POST",o=t.getAttribute("action")||location.href;c("Intercepting form submit event",n,o),e.preventDefault(),e.stopPropagation();const r=e.submitter,s=r?.style.pointerEvents||"auto";r&&(r.style.pointerEvents="none"),t.dataset.altchaprocessing="true",k("form",n,o,void 0,new FormData(t)).then(a=>{if(a)return b(typeof a=="object"?a:void 0).then(i=>{if(i)t.dataset.altcha=i,H(t,r);else throw new Error("Unable to receive verification payload.")}).catch(i=>{try{L?.(String(i.message||i))}catch{}t.dispatchEvent(new Event(String(i.message||i)))}).finally(()=>{requestAnimationFrame(()=>{delete t.dataset.altcha})});requestAnimationFrame(()=>{H(t,r)})}).finally(()=>{requestAnimationFrame(()=>{r&&(r.style.pointerEvents=s),delete t.dataset.altchaprocessing})})}function P(e){const t=e.target,n=t.closest("form");n&&(e.preventDefault(),e.stopPropagation(),n.dataset.altchaprocessing||H(n,t))}async function z(e,t){if(t instanceof FormData)return Object.fromEntries(t.entries());const n=new Response(t,{headers:e}),o=n.headers.get("content-type");return o?.includes("application/x-www-form-urlencoded")||o?.includes("multipart/form-data")?Object.fromEntries((await n.formData()).entries()):o?.includes("application/json")?n.json():null}async function b(e,t){w=!0;const n=document.createElement("altcha-widget"),o=n,r=()=>{o.configure({overlay:!0}),n.style.display="block",o.show()};if(!T)throw requestAnimationFrame(()=>{alert(v)}),new Error(v);let s=null;n.style.display=g?"none":"block",document.body.append(n),F&&Q();const a=new URL(t||E.challengeurl||location.href,location.origin);if(e)for(const i in e)e[i]!==null&&e[i]!==void 0&&a.searchParams.set("params."+i,e[i]);return new Promise((i,y)=>{requestAnimationFrame(()=>{"verify"in n?(n.addEventListener("code",()=>{c("Code verification requested"),g&&r()}),n.addEventListener("statechange",K=>{const m=K;if(c("Widget state change:",m.detail.state),m.detail.state==="verified"){const M=m.detail.payload;if(M){try{O?.(M)}catch{}i(M)}else y(new Error("Verification failed."))}else m.detail.state==="error"?y(new Error("Verification failed.")):m.detail.state==="unverified"&&y(new Error("Verification failed."))}),o.configure({customfetch:R,overlay:!g,...E,challengeurl:a.toString()}),g||o.show(),T?o.verify():y(new Error(v))):y(new Error("Failed to render widget."))})}).catch(i=>{throw s=i,i}).finally(()=>{w=!1,F&&J(),s?(o?.reset("error",s),g&&r()):(o?.reset(),n?.remove())})}function H(e,t){e&&"requestSubmit"in e?e.requestSubmit(t):e?.reportValidity()&&(t?t.click():e.submit())}function Q(){c("Removing global click listeners",u.length);for(const[e,t]of u)window.removeEventListener("click",e,t)}function J(){if(c("Restoring global click listeners",u.length),u)for(const[e,t]of u)S.call(window,"click",e,t)}async function k(e,t,n,o,r){if(E.challengeurl&&Y(n,E.challengeurl))return!1;const s=new Headers(o),a=await z(s,r);if(A)try{return await A({body:a,headers:s,method:t,source:e,url:new URL(n,location.origin)})}catch(i){c("Filter function error",i)}return!0}return{destroy:j,requestAltchaVerification:b}};globalThis.altchaInterceptor=X,f.interceptor=X,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})}));
